import math

 #【資料庫】苗栗市避難所資料
shelters = [
    {"name": "建功國小操場", "address": "苗栗縣苗栗市建功里中正路241號",
     "lat": 24.55438701578612, "lon": 120.81516325183188},

    {"name": "大同國小活動中心", "address": "苗栗縣苗栗市大同里大同路80號",
     "lat": 24.56547988694313, "lon": 120.82517510156349},

    {"name": "維新社區活動中心", "address": "苗栗縣苗栗市維新里僑育北街62號1樓",
     "lat": 24.553262523711048, "lon": 120.82167178251852},

    {"name": "高苗里社區活動中心", "address": "苗栗縣苗栗市高苗里22鄰松園1號",
     "lat": 24.54959920520317, "lon": 120.81140292884962},

    {"name": "苗栗市老人文康中心室外草皮", "address": "苗栗縣苗栗市大同里福星山21號",
     "lat": 24.55676485537507, "lon": 120.80831805482921},

    {"name": "勝利社區活動中心", "address": "苗栗縣苗栗市復興路一段449號",
     "lat": 24.548138729302718, "lon": 120.8212071677126},

    {"name": "苗栗市恭敬里活動中心", "address": "苗栗縣苗栗市恭敬路107號",
     "lat": 24.548440963722076, "lon": 120.81478101660939},

    {"name": "國立聯合大學活動中心、操場", "address": "苗栗縣苗栗市恭敬里聯大1號",
     "lat": 24.546022406876844, "lon": 120.81239705978817},

    {"name": "上苗里社區活動中心室內空間", "address": "苗栗縣苗栗市北苗里中華路45號2樓",
     "lat": 24.571238180193863, "lon": 120.82430810950412},

    {"name": "清華里社區活動中心", "address": "苗栗縣苗栗市清華里啟賢街126巷23號",
     "lat": 24.572578235924503, "lon": 120.82983814944413},

    {"name": "福星國小操場", "address": "苗栗縣苗栗市清華里啟賢街126巷23號",
     "lat": 24.57952418333503, "lon": 120.82596278013091},
]

 #【資料庫】苗栗市行政區 里別
village_coords = {
    "北苗里": (24.572710051971512, 120.82470455934795),
    "中苗里": (24.559583200595437, 120.821471246961),
    "南勢里": (24.533497529385834, 120.80420472421532),
    "青華里": (24.571077858541113, 120.8279207512186),
    "建功里": (24.55955392601294, 120.82153561997818),
    "維祥里": (24.564085302189774, 120.82231395504212),
    "維新里": (24.555084262942703, 120.82223699354127),
    "文山里": (24.570788175009024, 120.81436218495476),
    "文聖里": (22.984043367962116, 120.2426751021398),
    "水源里": (24.536904019601018, 120.81563364818722),
    "新英里": (24.550953165989448, 120.80448711391553),
    "新川里": (24.57509629498213, 120.8049471047905),
    "福麗里": (24.56313530932304, 120.8115324256474),
    "福安里": (24.583463654670123, 120.82505838088032),
    "福興里": (24.575616441980912, 120.8252350042653),
    "玉華里": (24.562113249030865, 120.8375594490733),
    "玉苗里": (24.55605629026079, 120.81763936441808),
    "玉清里": (25.085658780605215, 121.48177762368483),
    "恭敬里": (24.5476103030753, 120.8146946355819),
    "光華里": (24.562579258723297, 120.83517372570255),
    "嘉城里": (24.573156894977664, 120.83594405896001),
    "嘉新里": (24.586487229131777, 120.83179639647108),
    "大同里": (24.55503259473465, 120.81534829046065),
    "綠苗里": (24.553908624187745, 120.81790757842107),
    "高苗里": (24.55166127837861, 120.813936707713),
    "新苗里": (24.55210581024262, 120.81770591256472),
    "勝利里": (24.549646590743272, 120.82016313142587),
    "上苗里": (24.567824660239612, 120.82329386445026),
}

# 距離計算區
def haversine(lat1, lon1, lat2, lon2):
    R = 6371
    d_lat = math.radians(lat2 - lat1)
    d_lon = math.radians(lon2 - lon1)
    a = math.sin(d_lat/2)**2 + math.cos(math.radians(lat1)) \
        * math.cos(math.radians(lat2)) * math.sin(d_lon/2)**2
    return 2 * R * math.atan2(math.sqrt(a), math.sqrt(1-a))

# 找最近避難所
def find_nearest_shelter(lat, lon):
    nearest = None
    min_dist = float("inf")
    for s in shelters:
        d = haversine(lat, lon, s["lat"], s["lon"])
        if d < min_dist:
            min_dist = d
            nearest = s
            nearest["distance"] = round(d, 3)
    return nearest

# 使用者介面
if __name__ == "__main__":
    print("=== 苗栗市避難所智慧查詢系統（行政里點選版） ===\n")

    villages = list(village_coords.keys())
    for i, v in enumerate(villages, 1):
        print(f"{i}. {v}")

    choice = input("\n請輸入您所在行政里的編號：")

    if not choice.isdigit() or not (1 <= int(choice) <= len(villages)):
        print("\n⚠ 輸入錯誤，請重新執行程式。")
    else:
        village = villages[int(choice) - 1]
        user_lat, user_lon = village_coords[village]
        shelter = find_nearest_shelter(user_lat, user_lon)

        print("\n【查詢結果】")
        print("所在里別：", village)
        print("最近避難所：", shelter["name"])
        print("避難所地址：", shelter["address"])
        print("距離：約", shelter["distance"], "公里")
        print("導航連結：")
        print(f"https://www.google.com/maps/dir/{user_lat},{user_lon}/{shelter['lat']},{shelter['lon']}/")
